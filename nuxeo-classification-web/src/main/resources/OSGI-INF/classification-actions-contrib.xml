<?xml version="1.0" encoding="UTF-8"?>

<component name="org.nuxeo.ecm.classification.web.actions">

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

    <!-- disable to use default create document form -->
    <action id="newClassificationRoot"
      link="#{documentActions.createDocument('ClassificationRoot')}"
      enabled="false" label="command.createClassificationRoot"
      icon="/icons/action_add_file.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter id="newClassificationRoot">
        <rule grant="true">
          <permission>AddChildren</permission>
          <facet>Folderish</facet>
        </rule>
      </filter>
    </action>

    <!-- disable to use default create document form -->
    <action id="newClassificationFolder"
      link="#{documentActions.createDocument('ClassificationFolder')}"
      enabled="false" label="command.createClassificationFolder"
      icon="/icons/action_add_file.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter id="newClassificationFolder">
        <rule grant="true">
          <permission>AddChildren</permission>
          <schema>classification</schema>
        </rule>
      </filter>
    </action>

    <!-- avoid rights setting on classification folders -->
    <action id="TAB_RIGHTS">
      <filter-id>is_not_classification_folder</filter-id>
    </action>

    <action id="unclassify_selection"
            link="#{classificationActions.unclassify()}"
            label="label.classification.unclassify">
      <category>CURRENT_DOCUMENT_CLASSIFICATIONS</category>
      <filter-id>canUnclassifyFromCurrentSelection</filter-id>
    </action>

    <action id="CURRENT_SELECTION_CLASSIFICATION"
      link="#{classificationActions.showCurrentSelectionClassificationForm(facesContext.viewRoot.viewId)}"
      label="action.classificationRequest">
      <category>CURRENT_SELECTION_LIST</category>
      <filter-id>canClassifyFromCurrentSelection</filter-id>
    </action>

    <!-- remove generic actions for classification folder documents -->
    <action id="newDocument">
      <filter-id>is_not_classification_container</filter-id>
    </action>
    <action id="newFile">
      <filter-id>is_not_classification_container</filter-id>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="is_not_classification_folder">
      <rule grant="false">
        <type>ClassificationFolder</type>
      </rule>
    </filter>

    <filter id="canClassifyFromCurrentSelection">
      <rule grant="true">
        <condition>
          #{classificationActions.canClassifyFromCurrentSelection}
        </condition>
      </rule>
    </filter>

    <filter id="canUnclassifyFromCurrentSelection">
      <rule grant="true">
        <condition>
          #{classificationActions.canUnclassifyFromCurrentSelection}
        </condition>
      </rule>
    </filter>

  </extension>

</component>
